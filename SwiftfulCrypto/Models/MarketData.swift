//
//  MarketData.swift
//  SwiftfulCrypto
//
//  Created by David J on 5/23/25.
//


import Foundation

// JSON Data:
/*
    URL: https://api.coingecko.com/api/v3/global
 
    Response:
     {
         "data": {
             "active_cryptocurrencies": 17187,
             "upcoming_icos": 0,
             "ongoing_icos": 49,
             "ended_icos": 3376,
             "markets": 1272,
             "total_market_cap": {
                 "btc": 32629025.626734525,
                 "eth": 1386521948.4923427,
                 "ltc": 36085786867.115364,
                 "bch": 8039187314.057899,
                 "bnb": 5336668721.1996565,
                 "eos": 4734743097397.126,
                 "xrp": 1509714697149.9927,
                 "xlm": 12132055830553.695,
                 "link": 219776280985.43756,
                 "dot": 753113779526.8533,
                 "yfi": 619943519.0528631,
                 "usd": 3574343739938.991,
                 "aed": 13128439454765.018,
                 "ars": 4052358707230044.5,
                 "aud": 5499878456081.525,
                 "bdt": 435514390322433.2,
                 "bhd": 1347759922300.096,
                 "bmd": 3574343739938.991,
                 "brl": 20261524924218.168,
                 "cad": 4904267686976.791,
                 "chf": 2933921423366.643,
                 "clp": 3364100841155778.5,
                 "cny": 25665932659005.926,
                 "czk": 78105672967899.33,
                 "dkk": 23458485877750.66,
                 "eur": 3144807704023.044,
                 "gbp": 2640517843130.0107,
                 "gel": 9793701847432.838,
                 "hkd": 27993062766049.305,
                 "huf": 1269422546073598.5,
                 "idr": 5.811700567773917e+16,
                 "ils": 12907938189448.182,
                 "inr": 304295102446006.0,
                 "jpy": 509548486480602.56,
                 "krw": 4.880155610900132e+15,
                 "kwd": 1095750816915.6973,
                 "lkr": 1070449288600978.2,
                 "mmk": 7.498973166392003e+15,
                 "mxn": 68822748415247.52,
                 "myr": 15123048363681.873,
                 "ngn": 5.679274768389063e+15,
                 "nok": 36053272237799.055,
                 "nzd": 5968457048668.826,
                 "php": 197730915670242.53,
                 "pkr": 1.00777732093423e+15,
                 "pln": 13393212541644.74,
                 "rub": 284155376859070.0,
                 "sar": 13405854995452.904,
                 "sek": 33993438704315.793,
                 "sgd": 4589700417455.98,
                 "thb": 116092897501348.48,
                 "try": 139504634537324.5,
                 "twd": 107226737854429.8,
                 "uah": 148417550174705.3,
                 "vef": 357899038680.091,
                 "vnd": 9.276781678351669e+16,
                 "zar": 63691645725846.734,
                 "xdr": 2581158716640.8438,
                 "xag": 106802820686.87306,
                 "xau": 1062652393.8838624,
                 "bits": 32629025626734.523,
                 "sats": 3262902562673452.5
             },
             "total_volume": {
                 "btc": 1610524.4221384008,
                 "eth": 68436841.64593053,
                 "ltc": 1781145465.586701,
                 "bch": 396803375.3612033,
                 "bnb": 263410725.3669259,
                 "eos": 233700493485.20593,
                 "xrp": 74517468527.44366,
                 "xlm": 598821810659.4053,
                 "link": 10847858957.939163,
                 "dot": 37172674061.80706,
                 "yfi": 30599570.738115884,
                 "usd": 176424756048.2659,
                 "aed": 648001954098.8188,
                 "ars": 200018926091123.4,
                 "aud": 271466536379.02722,
                 "bdt": 21496399243754.88,
                 "bhd": 66523600639.339386,
                 "bmd": 176424756048.2659,
                 "brl": 1000081372135.2001,
                 "cad": 242067997154.92438,
                 "chf": 144814379657.58603,
                 "clp": 166047451897506.8,
                 "cny": 1266835603280.1782,
                 "czk": 3855190015827.2056,
                 "dkk": 1157879026015.134,
                 "eur": 155223440264.43372,
                 "gbp": 130332377132.60806,
                 "gel": 483403831572.2486,
                 "hkd": 1381699587076.7424,
                 "huf": 62656974065126.09,
                 "idr": 2.868576526197736e+15,
                 "ils": 637118310898.2014,
                 "inr": 15019593279698.111,
                 "jpy": 25150621754033.6,
                 "krw": 240877857803717.38,
                 "kwd": 54084773214.156395,
                 "lkr": 52835924114755.34,
                 "mmk": 370139138189261.8,
                 "mxn": 3396997458319.011,
                 "myr": 746453142840.213,
                 "ngn": 280321294885089.66,
                 "nok": 1779540587611.191,
                 "nzd": 294594939773.17456,
                 "php": 9759729645061.559,
                 "pkr": 49742520846590.766,
                 "pln": 661070794327.8503,
                 "rub": 14025523757550.012,
                 "sar": 661694808689.993,
                 "sek": 1677869999921.4282,
                 "sgd": 226541383649.38464,
                 "thb": 5730187864069.652,
                 "try": 6885759430700.432,
                 "twd": 5292566256691.928,
                 "uah": 7325688850312.022,
                 "vef": 17665410823.112854,
                 "vnd": 4.578893535696013e+15,
                 "zar": 3143733193295.752,
                 "xdr": 127402491208.9145,
                 "xag": 5271642280.624605,
                 "xau": 52451079.973149456,
                 "bits": 1610524422138.401,
                 "sats": 161052442213840.1
             },
             "market_cap_percentage": {
                 "btc": 60.89314534639523,
                 "eth": 8.706715046412198,
                 "usdt": 4.2659874937767555,
                 "xrp": 3.8869766699805095,
                 "bnb": 2.7333772225623005,
                 "sol": 2.6390293524471238,
                 "usdc": 1.7161295686646574,
                 "doge": 0.9829668157469422,
                 "ada": 0.7885137139310524,
                 "trx": 0.7153361500784692
             },
             "market_cap_change_percentage_24h_usd": -3.4746581000188645,
             "updated_at": 1748023037
         }
     }
 */

struct GlobalMarketData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$\(item.value.asAbbreviatedNumber())"
        }
        
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: {$0.key == "usd"}) {
            return "$\(item.value.asAbbreviatedNumber())"
        }
        
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
            return item.value.asNormalPercentage()
        }
        return ""
    }
    
}
